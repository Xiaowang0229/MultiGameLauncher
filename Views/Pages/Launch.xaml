<Page x:Class="MultiGameLauncher.Views.Pages.Launch"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:MultiGameLauncher.Views.Pages"
      xmlns:ffme="clr-namespace:Unosquare.FFME;assembly=ffme.win"
      xmlns:ui="http://metro.mahapps.com/winfx/xaml/controls" xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
      mc:Ignorable="d" 
      Title="Launch" d:DesignHeight="450" d:DesignWidth="800" Loaded="Page_Loaded">
    <Grid>
        <Grid.Resources>
            <Style TargetType="TabItem">
                <Setter Property="Padding" Value="0"/>
                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                <Setter Property="VerticalContentAlignment" Value="Stretch"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabItem">
                            <Border x:Name="Capsule"
                                    
                                Width="20"
                                Height="20"
                                CornerRadius="10"
                                Background="Gray"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                ToolTip="{TemplateBinding Header}">

                                <!-- 关键：VisualStateManager 直接放在 Border 上 -->
                                <VisualStateManager.VisualStateGroups>
                                    <!-- WPF TabItem 内置识别这个组名 -->
                                    <VisualStateGroup x:Name="SelectionStates">

                                        <!-- 未选中状态（默认） -->
                                        <VisualState x:Name="Unselected">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Width"
                                                             To="20"
                                                             Duration="0:0:0.3">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <ColorAnimation Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                            To="#FF808080" 
                                                    Duration="0:0:0.3">
                                                    <ColorAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </ColorAnimation.EasingFunction>
                                                </ColorAnimation>
                                            </Storyboard>
                                        </VisualState>

                                        <!-- 选中状态 -->
                                        <VisualState x:Name="Selected">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Width"
                                                             To="50"
                                                             Duration="0:0:0.3">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <ColorAnimation Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                            To="{DynamicResource MahApps.Colors.Accent}"
                                                            Duration="0:0:0.3">
                                                    <ColorAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </ColorAnimation.EasingFunction>
                                                </ColorAnimation>
                                            </Storyboard>
                                        </VisualState>

                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </Grid.Resources>
        <Image x:Name="BackgroundImage" />
        <ffme:MediaElement LoopingBehavior="Play"  Visibility="Hidden" x:Name="BackgroundVideo" Stretch="UniformToFill" IsMuted="true"  MediaFailed="BackgroundVideo_MediaFailed" LoadedBehavior="Manual" UnloadedBehavior="Manual" MediaEnded="BackgroundVideo_MediaEnded" MediaOpened="BackgroundVideo_MediaOpened" />
        <Rectangle Fill="White" Opacity="0.25"/>
        <ui:MetroTabControl SelectedIndex="0" x:Name="RootTabControl" Margin="10,5,10,10" VerticalAlignment="Top" HorizontalAlignment="Center" Background="#FF894343"/>
        <StackPanel x:Name="sp_ani" Margin="10,10,10,50"  HorizontalAlignment="Center" VerticalAlignment="Center">
            <StackPanel>
                <TextBlock x:Name="MainTitle"   Text="主标题" VerticalAlignment="Top" FontSize="48" FontWeight="Bold" FontFamily="Microsoft YaHei UI" Margin="0,0,0,10"/>
            </StackPanel>
            <StackPanel Tag="ani" Orientation="Horizontal"  >
                <StackPanel Tag="ani">
                    <StackPanel  Orientation="Horizontal"  Margin="0,0,0,0">
                        <ui:Tile x:Name="SettingsTile" Title="设置"
Margin="3,3,0,0"
ui:ControlsHelper.MouseOverBorderBrush="{DynamicResource MahApps.Brushes.ThemeForeground}"
Background="{DynamicResource MahApps.Brushes.DataGrid.Selection.BorderBrush}"
HorizontalTitleAlignment="Right" Click="SettingsTile_Click" Width="95" Height="95">
                            <Label Foreground="{DynamicResource MahApps.Brushes.Badged.Foreground}" Content="" FontSize="36" FontFamily="Segoe MDL2 Assets" FontWeight="Bold"/>
                        </ui:Tile>
                        <ui:Tile x:Name="UserTile" Title="个性化"
Margin="10,3,3,0"
ui:ControlsHelper.MouseOverBorderBrush="{DynamicResource MahApps.Brushes.ThemeForeground}"
Background="{DynamicResource MahApps.Brushes.SystemControlRevealFocusVisual}"
HorizontalTitleAlignment="Right" Click="UserTile_Click" Width="95" Height="95">
                            <Label Foreground="{DynamicResource MahApps.Brushes.Badged.Foreground}" Content="" FontSize="36" FontFamily="Segoe MDL2 Assets" FontWeight="Bold"/>
                        </ui:Tile>
                    </StackPanel>
                    <StackPanel Margin="0,10,0,0">
                        <ui:Tile x:Name="AboutTile" Title="关于"
Margin="3,0,3,3"
ui:ControlsHelper.MouseOverBorderBrush="{DynamicResource MahApps.Brushes.ThemeForeground}"
Background="{DynamicResource MahApps.Brushes.AccentBase}"
HorizontalTitleAlignment="Right" Width="200" Click="AboutTile_Click" Height="95">
                            <Label Foreground="{DynamicResource MahApps.Brushes.Badged.Foreground}" Content="" FontSize="36" FontFamily="Segoe MDL2 Assets" FontWeight="Bold"/>
                        </ui:Tile>
                    </StackPanel>
                </StackPanel>
                <StackPanel Tag="ani" Margin="5,0,5,0">
                    <ui:Tile x:Name="ManageTile" Title="游戏管理"
ui:ControlsHelper.MouseOverBorderBrush="{DynamicResource MahApps.Brushes.ThemeForeground}"
Background="{DynamicResource MahApps.Brushes.CheckmarkFill}"
HorizontalTitleAlignment="Right" Height="200" Width="200" Click="ManageTile_Click">
                        <Label Foreground="{DynamicResource MahApps.Brushes.Badged.Foreground}" Content="" FontSize="48" FontFamily="Segoe MDL2 Assets" FontWeight="Bold"/>
                    </ui:Tile>
                </StackPanel>
                <StackPanel Tag="ani">
                    <ui:Tile Tag="false" x:Name="LaunchTile" Title="启动游戏"
ui:ControlsHelper.MouseOverBorderBrush="{DynamicResource MahApps.Brushes.ThemeForeground}"
Background="{DynamicResource MahApps.Brushes.Dialog.Background.Accent}"
HorizontalTitleAlignment="Right" Height="200" Width="200" Click="NewLaunchTile_Click">
                        <Label x:Name="NewLaunchLabel" Foreground="{DynamicResource MahApps.Brushes.Badged.Foreground}" Content="" FontSize="48" FontFamily="Segoe MDL2 Assets" FontWeight="Bold"/>
                    </ui:Tile>
                </StackPanel>
            </StackPanel>
        </StackPanel>
        <Grid Background="{DynamicResource MahApps.Brushes.Accent}" HorizontalAlignment="Stretch" VerticalAlignment="Bottom" >
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,10,10,10">
                <Label x:Name="Welcome" FontSize="18" Content="你好，用户！" VerticalAlignment="Center" FontWeight="Bold"/>
                <Image Height="48" Width="48" x:Name="UserHead" HorizontalAlignment="Center" VerticalAlignment="Center" MouseLeftButtonDown="UserHead_MouseLeftButtonDown" >
                    <Image.Source>
                        <DrawingImage>
                            <DrawingImage.Drawing>
                                <DrawingGroup xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
                                    <DrawingGroup x:Name="DrawingLayer">
                                        <DrawingGroup.ClipGeometry>
                                            <RectangleGeometry Rect="0,0,32,32" />
                                        </DrawingGroup.ClipGeometry>
                                        <GeometryDrawing Brush="#FF0891B2">
                                            <GeometryDrawing.Geometry>
                                                <PathGeometry FillRule="Nonzero" Figures="M16,5C12.146,5 9,8.146 9,12 9,14.41 10.23,16.552 12.094,17.813 8.527,19.343 6,22.88 6,27L8,27C8,22.57 11.57,19 16,19 20.43,19 24,22.57 24,27L26,27C26,22.88,23.473,19.342,19.906,17.812A7.02,7.02,0,0,0,23,12C23,8.146,19.854,5,16,5 M16,7C18.773,7 21,9.227 21,12 21,14.773 18.773,17 16,17 13.227,17 11,14.773 11,12 11,9.227 13.227,7 16,7" />
                                            </GeometryDrawing.Geometry>
                                        </GeometryDrawing>
                                    </DrawingGroup>
                                </DrawingGroup>
                            </DrawingImage.Drawing>
                        </DrawingImage>
                    </Image.Source>
                </Image>
            </StackPanel>
            <StackPanel HorizontalAlignment="Left" VerticalAlignment="Center" Orientation="Horizontal" Margin="10,10,0,10">
                <Image x:Name="NewGameImage" Height="48" Width="48" Margin="0,0,10,0" MouseLeftButtonDown="NewGameImage_MouseLeftButtonDown"/>
                <StackPanel VerticalAlignment="Center">
                    <Label x:Name="NewGameNameBlock" Content="当前游戏：xxxx" FontSize="18" FontWeight="Bold"/>
                    <Label x:Name="NewGameTimeBlock" Content="游戏时长：xxx 分钟" FontSize="12" Margin="0,-10,0,0"/>
                </StackPanel>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
